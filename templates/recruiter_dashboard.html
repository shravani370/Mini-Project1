{% extends "base.html" %}

{% block content %}
<!-- Logout Confirmation Modal -->
<div id="logoutModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div style="font-size: 3rem; margin-bottom: 16px;">üëã</div>
        <h3 class="heading-small text-gradient mb-3">Confirm Logout</h3>
        <p style="color: rgba(255,255,255,0.7); margin-bottom: 24px;">
            Are you sure you want to log out? You'll need to log in again to access your account.
        </p>
        <div class="flex-center gap-3">
            <a href="/logout" class="primary-btn hover-scale" style="text-decoration: none;">
                <i class="bi bi-box-arrow-left"></i> Yes, Logout
            </a>
            <button onclick="closeLogoutModal()" class="secondary-btn hover-scale" style="border: none; cursor: pointer;">
                <i class="bi bi-x"></i> Cancel
            </button>
        </div>
    </div>
</div>

<!-- Logout Modal Script -->
<script>
    function openLogoutModal() {
        document.getElementById('logoutModal').style.display = 'flex';
    }
    
    function closeLogoutModal() {
        document.getElementById('logoutModal').style.display = 'none';
    }
    
    // Close modal when clicking outside
    document.addEventListener('click', function(event) {
        var modal = document.getElementById('logoutModal');
        var modalContent = modal.querySelector('.modal-content');
        if (event.target === modal && !modalContent.contains(event.target)) {
            closeLogoutModal();
        }
    });
    
    // Close modal on Escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeLogoutModal();
        }
    });
</script>

<!-- HEADER -->
<div class="flex-between flex-wrap mb-4 animate-fadeInUp">
    <div>
        <div class="flex align-center gap-2 mb-2">
            <div class="avatar" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                <span style="font-size: 1.5rem;">üíº</span>
            </div>
            <h1 class="heading-medium text-gradient">{{ company_name }} Dashboard</h1>
        </div>
        <p style="color: rgba(255,255,255,0.7);">Browse student profiles and find top candidates</p>
    </div>
    <a href="#" onclick="openLogoutModal(); return false;" class="secondary-btn hover-scale"><i class="bi bi-box-arrow-left"></i> Logout</a>
</div>

<!-- Stats Overview -->
<div class="grid grid-4 gap-2 mb-4">
    <div class="dashboard-card text-center hover-lift animate-fadeInUp animate-delay-100">
        <div style="font-size: 2.5rem;" class="animate-float">üë®‚Äçüéì</div>
        <h3 style="font-size: 2rem; font-weight: 700; color: var(--primary-light);">{{ students|length }}</h3>
        <p style="color: rgba(255,255,255,0.7);" class="mt-1">Available Students</p>
    </div>
    <div class="dashboard-card text-center hover-lift animate-fadeInUp animate-delay-200">
        <div style="font-size: 2.5rem;" class="animate-float animate-delay-100">üèÜ</div>
        <h3 style="font-size: 2rem; font-weight: 700; color: var(--secondary-light);">
            {% set high = 0 %}{% for s in students %}{% if (s.score or 0) >= 80 %}{% set high = high + 1 %}{% endif %}{% endfor %}{{ high }}
        </h3>
        <p style="color: rgba(255,255,255,0.7);" class="mt-1">High Scorers (80%+)</p>
    </div>
    <div class="dashboard-card text-center hover-lift animate-fadeInUp animate-delay-300">
        <div style="font-size: 2.5rem;" class="animate-float animate-delay-200">üìä</div>
        <h3 style="font-size: 2rem; font-weight: 700; color: var(--accent-light);">
            {% set total = 0 %}{% for s in students %}{% set total = total + (s.score or 0) %}{% endfor %}
            {% if students|length > 0 %}{{ (total / students|length)|round|int }}%{% else %}0%{% endif %}
        </h3>
        <p style="color: rgba(255,255,255,0.7);" class="mt-1">Average Score</p>
    </div>
    <div class="dashboard-card text-center hover-lift animate-fadeInUp animate-delay-400">
        <div style="font-size: 2.5rem;" class="animate-float animate-delay-300">ü§ñ</div>
        <h3 style="font-size: 2rem; font-weight: 700; color: var(--success);">
            {% set ai_cnt = 0 %}{% for s in students %}{% if s.interest and 'AI' in s.interest|string %}{% set ai_cnt = ai_cnt + 1 %}{% endif %}{% endfor %}{{ ai_cnt }}
        </h3>
        <p style="color: rgba(255,255,255,0.7);" class="mt-1">AI Candidates</p>
    </div>
</div>

<!-- Search & Filter -->
<div class="glass-card p-3 mb-4 animate-fadeInUp animate-delay-200">
    <div class="flex-between flex-wrap mb-3">
        <h3 class="heading-small text-gradient"><i class="bi bi-funnel"></i> Filter Students</h3>
        <a href="/recruiter_dashboard" class="secondary-btn hover-scale" style="padding: 10px 16px;"><i class="bi bi-arrow-clockwise"></i> Reset</a>
    </div>
    <form method="GET" action="/recruiter_dashboard" class="d-flex gap-2 flex-wrap">
        <input type="text" name="search" placeholder="Search by name..." value="{{ request.args.get('search', '') }}" class="glass-input" style="flex: 1; min-width: 200px;">
        <select name="year" class="glass-input" style="width: 120px;">
            <option value="">All Years</option>
            <option value="1" {% if request.args.get('year') == '1' %}selected{% endif %}>1st Year</option>
            <option value="2" {% if request.args.get('year') == '2' %}selected{% endif %}>2nd Year</option>
            <option value="3" {% if request.args.get('year') == '3' %}selected{% endif %}>3rd Year</option>
            <option value="4" {% if request.args.get('year') == '4' %}selected{% endif %}>4th Year</option>
        </select>
        <select name="skill" class="glass-input" style="width: 130px;">
            <option value="">All Skills</option>
            <option value="Python" {% if request.args.get('skill') == 'Python' %}selected{% endif %}>Python</option>
            <option value="Java" {% if request.args.get('skill') == 'Java' %}selected{% endif %}>Java</option>
            <option value="AI" {% if request.args.get('skill') == 'AI' %}selected{% endif %}>AI/ML</option>
            <option value="Web" {% if request.args.get('skill') == 'Web' %}selected{% endif %}>Web Dev</option>
        </select>
        <select name="interest" class="glass-input" style="width: 140px;">
            <option value="">All Interests</option>
            <option value="AI" {% if request.args.get('interest') == 'AI' %}selected{% endif %}>AI</option>
            <option value="Web" {% if request.args.get('interest') == 'Web' %}selected{% endif %}>Web</option>
            <option value="Cloud" {% if request.args.get('interest') == 'Cloud' %}selected{% endif %}>Cloud</option>
            <option value="Backend" {% if request.args.get('interest') == 'Backend' %}selected{% endif %}>Backend</option>
        </select>
        <button type="submit" class="primary-btn hover-scale" style="padding: 14px 24px;"><i class="bi bi-search"></i> Search</button>
    </form>
</div>

<!-- Student Cards Grid -->
{% if students %}
<div class="grid grid-3 gap-2">
    {% for student in students %}
    <div class="dashboard-card hover-lift animate-fadeInUp animate-delay-{{ loop.index + 1 }}00">
        <div class="flex-between mb-2">
            <div class="flex align-center gap-2">
                <div class="avatar" style="background: linear-gradient(135deg, #22c55e, #16a34a);">{{ student.name[:1] }}</div>
                <div>
                    <strong>{{ student.name }}</strong>
                    <p style="font-size: 12px; color: rgba(255,255,255,0.6);">{{ student.year }}st Year</p>
                </div>
            </div>
            <span class="badge badge-{{ 'success' if (student.score or 0) >= 80 else 'warning' if (student.score or 0) >= 60 else 'danger' }}">{{ student.score or 0 }}%</span>
        </div>
        <div class="mb-2">
            <p style="font-size: 12px; color: rgba(255,255,255,0.6);">CGPA: <span style="color: #22c55e; font-weight: 600;">{{ student.cgpa }}</span></p>
            <p style="font-size: 12px; color: rgba(255,255,255,0.6);">Interest: <span class="badge badge-info" style="padding: 3px 8px; font-size: 10px;">{{ student.interest }}</span></p>
        </div>
        <div class="flex gap-1 flex-wrap mb-2">
            {% set skills_str = student.skills if student.skills is string else (student.skills|join(',')) %}
            {% set skills_list = skills_str.split(',') %}
            {% for skill in skills_list[:4] %}<span style="background: rgba(255,255,255,0.1); padding: 4px 10px; border-radius: 12px; font-size: 11px;">{{ skill.strip() }}</span>{% endfor %}
            {% if skills_list|length > 4 %}<span style="background: rgba(34, 197, 94, 0.2); padding: 4px 10px; border-radius: 12px; font-size: 11px; color: #22c55e;">+{{ skills_list|length - 4 }}</span>{% endif %}
        </div>
        <button class="primary-btn w-full hover-scale view-profile-btn" style="padding: 10px;"
            data-name="{{ student.name }}"
            data-email="{{ student.email|default('') }}"
            data-skills="{{ skills_str }}"
            data-interest="{{ student.interest|default('') }}"
            data-cgpa="{{ student.cgpa|default(0) }}"
            data-score="{{ student.score|default(0) }}">
            <i class="bi bi-person-lines-fill"></i> View Profile
        </button>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="glass-card p-4 text-center animate-fadeInUp">
    <div style="font-size: 3rem;" class="animate-float mb-3">üîç</div>
    <h3 class="heading-small">No Students Found</h3>
    <p style="color: rgba(255,255,255,0.7);">Try adjusting your search filters</p>
</div>
{% endif %}

<!-- Student Detail Modal -->
<div id="studentModal" class="modal-overlay" style="display: none;">
    <div class="modal-content" style="max-width: 450px;">
        <div class="flex-between mb-3">
            <div class="flex align-center gap-2">
                <div class="avatar" style="background: linear-gradient(135deg, #22c55e, #16a34a);"><span id="modalInitial">S</span></div>
                <h2 class="heading-small text-gradient" id="modalName">Student Name</h2>
            </div>
            <button class="icon-btn" onclick="closeStudentModal()" style="background: rgba(255,255,255,0.1); border: none; cursor: pointer; padding: 8px 12px; border-radius: 8px;">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        <div class="glass-card p-3 mb-3" style="background: rgba(15, 23, 42, 0.6);">
            <div class="grid grid-2 gap-2">
                <div class="text-center">
                    <div style="font-size: 1.5rem; color: var(--primary-light);" id="modalScore">0%</div>
                    <p style="font-size: 11px; color: rgba(255,255,255,0.6);">Score</p>
                </div>
                <div class="text-center">
                    <div style="font-size: 1.5rem; color: var(--secondary-light);" id="modalCGPA">0</div>
                    <p style="font-size: 11px; color: rgba(255,255,255,0.6);">CGPA</p>
                </div>
            </div>
        </div>
        <div style="line-height: 2;">
            <p><i class="bi bi-envelope" style="color: var(--primary-light);"></i> <strong>Email:</strong> <span id="modalEmail">-</span></p>
            <p><i class="bi bi-briefcase" style="color: var(--accent-light);"></i> <strong>Interest:</strong> <span id="modalInterest">-</span></p>
            <p><i class="bi bi-gear" style="color: var(--secondary-light);"></i> <strong>Skills:</strong> <span id="modalSkills">-</span></p>
        </div>
        <div class="flex-center gap-2 mt-3">
            <a href="#" id="modalContact" class="primary-btn hover-scale" style="text-decoration: none;"><i class="bi bi-send"></i> Contact Student</a>
            <button class="secondary-btn hover-scale" onclick="closeStudentModal()" style="cursor: pointer;"><i class="bi bi-x"></i> Close</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var modal = document.getElementById('studentModal');
    var viewButtons = document.querySelectorAll('.view-profile-btn');
    
    viewButtons.forEach(function(btn) {
        btn.addEventListener('click', function() {
            var name = this.getAttribute('data-name');
            var email = this.getAttribute('data-email');
            var skills = this.getAttribute('data-skills');
            var interest = this.getAttribute('data-interest');
            var cgpa = this.getAttribute('data-cgpa');
            var score = this.getAttribute('data-score');
            
            document.getElementById('modalName').textContent = name || 'Student';
            document.getElementById('modalInitial').textContent = name ? name.charAt(0) : 'S';
            document.getElementById('modalEmail').textContent = email || 'Not provided';
            document.getElementById('modalScore').textContent = (score || '0') + '%';
            document.getElementById('modalCGPA').textContent = cgpa || 'N/A';
            document.getElementById('modalInterest').textContent = interest || 'Not specified';
            document.getElementById('modalSkills').textContent = skills || 'No skills listed';
            
            var contactLink = document.getElementById('modalContact');
            if (email) {
                contactLink.href = 'mailto:' + email;
                contactLink.style.display = 'inline-flex';
            } else {
                contactLink.style.display = 'none';
            }
            
            modal.style.display = 'flex';
        });
    });
    
    window.closeStudentModal = function() {
        modal.style.display = 'none';
    };
    
    modal.addEventListener('click', function(e) {
        if (e.target === modal) closeStudentModal();
    });
    
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') closeStudentModal();
    });
});
</script>
{% endblock %}

